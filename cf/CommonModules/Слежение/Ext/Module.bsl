
Функция СоздатьИПолучитьНовоеСобытие(стрСобытие)
	
	НовСобытие = Справочники.СобытияСистемы.СоздатьЭлемент();
	НовСобытие.Представление 	= стрСобытие;
	НовСобытие.Регистрировать 	= Истина;
	
	Если ОбщиеФункции.ЗаписатьОбъектИСообщитьЕслиОшибка(НовСобытие) Тогда
	
		// Добавим в параметр сеанса
		
		НовСостояния = Новый Структура;
		Для Каждого Элемент Из ПараметрыСеанса.СобытияСистемы Цикл НовСостояния.Вставить(Элемент.Ключ, Элемент.Значение) КонецЦикла;
		НовСостояния.Вставить(стрСобытие, НовСобытие.Ссылка);
		ПараметрыСеанса.СобытияСистемы = Новый ФиксированнаяСтруктура(НовСостояния); КонецЕсли;
	
	// Вернем что есть
	
	Возврат НовСобытие.Ссылка;
	
КонецФункции

Функция ПолучитьСобытиеСистемы(стрСобытие)
	
	МаскСтрСобытие = Справочники.СобытияСистемы.МаскироватьСобытие(стрСобытие);
	
	Возврат ?(ПараметрыСеанса.СобытияСистемы.Свойство(МаскСтрСобытие), 
					ПараметрыСеанса.СобытияСистемы[МаскСтрСобытие], 
					СоздатьИПолучитьНовоеСобытие(МаскСтрСобытие));
	
КонецФункции

Функция Записать(стрСобытие = "", ОбъектСобытия = "", Форма = "", СвязаннаяСсылка = Неопределено, Комментарий = "") Экспорт
	
	Событие = ПолучитьСобытиеСистемы(стрСобытие);
	Если Событие.Регистрировать Тогда
	
		НовЗапись = РегистрыСведений.СобытияВСистеме.СоздатьМенеджерЗаписи();
		НовЗапись.ДатаСобытия		= ТекущаяДата();
		НовЗапись.ГуидСобытия 		= Строка(Новый УникальныйИдентификатор);
		НовЗапись.Пользователь 		= ПараметрыСеанса.ТекущийПользователь;
		НовЗапись.Событие 			= ПолучитьСобытиеСистемы(стрСобытие);
		НовЗапись.ОбъектСобытия 	= ОбъектСобытия;
		НовЗапись.Форма 			= Форма;
		НовЗапись.СвязаннаяСсылка 	= СвязаннаяСсылка;
		НовЗапись.Комментарий 		= Комментарий;
		
		Возврат ОбщиеФункции.ЗаписатьОбъектИСообщитьЕслиОшибка(НовЗапись);
		
	Иначе Возврат Истина; КонецЕсли;
	
КонецФункции