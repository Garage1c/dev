<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Номенклатура</dataPath>
			<field>Номенклатура</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Смена</dataPath>
			<field>Смена</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Размещение</dataPath>
			<field>Размещение</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Контрагент</dataPath>
			<field>Контрагент</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ИнтернетЗаказ</dataPath>
			<field>ИнтернетЗаказ</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Склад</dataPath>
			<field>Склад</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Партнер</dataPath>
			<field>Партнер</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Цена</dataPath>
			<field>Цена</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Заказ</dataPath>
			<field>Заказ</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СтавкаНДС</dataPath>
			<field>СтавкаНДС</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Отдел</dataPath>
			<field>Отдел</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Упаковка</dataPath>
			<field>Упаковка</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаОборотЗАказ</dataPath>
			<field>СуммаОборотЗАказ</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сумма заказов</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Акция</dataPath>
			<field>Акция</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Менеджер</dataPath>
			<field>Менеджер</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДокументПродажи</dataPath>
			<field>ДокументПродажи</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаОплат</dataPath>
			<field>СуммаОплат</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сумма оплат</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Подразделение</dataPath>
			<field>Подразделение</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПроцентАвтоматическойСкидки</dataPath>
			<field>ПроцентАвтоматическойСкидки</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Организация</dataPath>
			<field>Организация</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПроцентРучнойСкидки</dataPath>
			<field>ПроцентРучнойСкидки</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КолОплат</dataPath>
			<field>КолОплат</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Кол. реализованных заказов</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаказИсточник</dataPath>
			<field>ЗаказИсточник</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Источник</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КолЗаказов</dataPath>
			<field>КолЗаказов</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Кол. заказов</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаказВидИсточника</dataPath>
			<field>ЗаказВидИсточника</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Вид источника</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Заказ1</dataPath>
			<field>Заказ1</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Заказ1</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ РАЗРЕШЕННЫЕ
	БП.Заказ КАК Заказ,
	ЕСТЬNULL(Рег.СуммаПриход, БП.Заказ.Сумма) КАК СуммаОборотЗАказ,
	БП.Заказ.Оператор КАК Автор,
	1 КАК КолЗаказов,
	БП.Заказ.Источник,
	БП.Заказ.ВидИсточника
ПОМЕСТИТЬ ЗакПокупИИнтЗаказы
ИЗ
	БизнесПроцесс.ИнтернетЗаявка КАК БП
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СостоянияЗаказовТекущее КАК Сос
		ПО БП.Заказ = Сос.Заказ
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ИнтернетЗаказПокупателя.Обороты(, , , НЕ ИнтернетЗаказ ЕСТЬ NULL ) КАК Рег
		ПО БП.Заказ = Рег.ИнтернетЗаказ
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗаказыЖурнал КАК ЗаказыЖурнал
		ПО БП.Заказ = ЗаказыЖурнал.Заказ
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ИнтернетЗаказПокупателя КАК ИнтернетЗаказПокупателя
		ПО БП.Заказ = ИнтернетЗаказПокупателя.Ссылка
ГДЕ
	БП.Дата МЕЖДУ &amp;НачалоПериода И &amp;КонецПериода
	И БП.Заказ.Источник &lt;&gt; ""
	И БП.Заказ.ВидИсточника &lt;&gt; ""
{ГДЕ
	(БП.Заказ.Оператор В (&amp;Автор)),
	(ЗаказыЖурнал.ПричинаОтказа В (&amp;ПричинаОтказа)),
	(БП.Заказ.Контрагент.ОсновнойМенеджер В (&amp;ОсновнойМенеджер))}
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ДолгиПоЗаказамОбороты.Заказ КАК ЗАказ,
	ВЫБОР
		КОГДА ДолгиПоЗаказамОбороты.Заказ ССЫЛКА Документ.ИнтернетЗаказПокупателя
			ТОГДА ДолгиПоЗаказамОбороты.Заказ.Оператор
		ИНАЧЕ ДолгиПоЗаказамОбороты.Заказ.Автор
	КОНЕЦ КАК Автор,
	ДолгиПоЗаказамОбороты.СуммаОборот КАК Сумма,
	ДолгиПоЗаказамОбороты.Регистратор КАК Оплата
ПОМЕСТИТЬ Оплаты
ИЗ
	РегистрНакопления.ДолгиПоЗаказам.Обороты(
			&amp;НачалоПериода,
			&amp;КонецПериода,
			Регистратор,
			Заказ.Источник &lt;&gt; ""
				И Заказ.ВидИсточника &lt;&gt; "") КАК ДолгиПоЗаказамОбороты
ГДЕ
	ДолгиПоЗаказамОбороты.Заказ &lt;&gt; НЕОПРЕДЕЛЕНО
	И (ТИПЗНАЧЕНИЯ(ДолгиПоЗаказамОбороты.Регистратор) = ТИП(Документ.ПлатежноеПоручениеВходящее)
			ИЛИ ТИПЗНАЧЕНИЯ(ДолгиПоЗаказамОбороты.Регистратор) = ТИП(Документ.ОплатаЭлектроннымиДеньгами)
			ИЛИ ТИПЗНАЧЕНИЯ(ДолгиПоЗаказамОбороты.Регистратор) = ТИП(Документ.ОплатаБанковскойКартой)
			ИЛИ ТИПЗНАЧЕНИЯ(ДолгиПоЗаказамОбороты.Регистратор) = ТИП(Документ.ПриходныйКассовыйОрдер))
	И ДолгиПоЗаказамОбороты.Заказ ССЫЛКА Документ.ИнтернетЗаказПокупателя

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ПродажиОбороты.Заказ,
	ВЫБОР
		КОГДА ПродажиОбороты.Заказ ССЫЛКА Документ.ИнтернетЗаказПокупателя
			ТОГДА ПродажиОбороты.Заказ.Оператор
		ИНАЧЕ ПродажиОбороты.Заказ.Автор
	КОНЕЦ,
	ПродажиОбороты.СуммаОборот,
	ПродажиОбороты.ДокументПродажи
ИЗ
	РегистрНакопления.Продажи.Обороты(
			&amp;НачалоПериода {(&amp;НачалоПериода)},
			&amp;КонецПериода {(&amp;КонецПериода)},
			Регистратор,
			Заказ.Источник &lt;&gt; ""
				И Заказ.ВидИсточника &lt;&gt; "") КАК ПродажиОбороты
ГДЕ
	ТИПЗНАЧЕНИЯ(ПродажиОбороты.Заказ) = ТИП(Документ.ИнтернетЗаказПокупателя)
	И ТИПЗНАЧЕНИЯ(ПродажиОбороты.Регистратор) = ТИП(Документ.ЧекККМ)
{ГДЕ
	(ПродажиОбороты.Контрагент.ОсновнойМенеджер В (&amp;ОсновнойМенеджер)),
	(ВЫБОР
			КОГДА ПродажиОбороты.Заказ ССЫЛКА Документ.ИнтернетЗаказПокупателя
				ТОГДА ПродажиОбороты.Заказ.Оператор В (&amp;Автор)
			ИНАЧЕ ПродажиОбороты.Заказ.Автор В (&amp;Автор)
		КОНЕЦ)}
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Оплаты.Сумма КАК Сумма,
	КурсУЕ.Валюта,
	КурсУЕ.Курс,
	КурсУЕ.Кратность,
	Оплаты.Оплата
ПОМЕСТИТЬ ТаблицаВалютПоДням
ИЗ
	Оплаты КАК Оплаты
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			Таб.Валюта КАК Валюта,
			Таб.Курс КАК Курс,
			Таб.Период КАК ПериодНач,
			Таб.Кратность КАК Кратность,
			ВЫБОР
				КОГДА МИНИМУМ(Таб1.Период) ЕСТЬ NULL 
					ТОГДА &amp;КонецПериода
				ИНАЧЕ ДОБАВИТЬКДАТЕ(МИНИМУМ(Таб1.Период), СЕКУНДА, -1)
			КОНЕЦ КАК ПериодКон
		ИЗ
			(ВЫБРАТЬ
				КурсыВалют.Валюта КАК Валюта,
				КурсыВалют.Период КАК Период,
				КурсыВалют.Курс КАК Курс,
				КурсыВалют.Кратность КАК Кратность
			ИЗ
				РегистрСведений.КурсыВалют КАК КурсыВалют) КАК Таб
				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
					КурсыВалют.Валюта КАК Валюта,
					КурсыВалют.Период КАК Период,
					КурсыВалют.Курс КАК Курс
				ИЗ
					РегистрСведений.КурсыВалют КАК КурсыВалют) КАК Таб1
				ПО Таб.Валюта = Таб1.Валюта
					И Таб.Период &lt; Таб1.Период
		
		СГРУППИРОВАТЬ ПО
			Таб.Валюта,
			Таб.Курс,
			Таб.Период,
			Таб.Кратность) КАК КурсУЕ
		ПО (Оплаты.Оплата.Дата МЕЖДУ КурсУЕ.ПериодНач И КурсУЕ.ПериодКон)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(-ЕСТЬNULL(Оплаты.Сумма * ЕСТЬNULL(ТаблицаВалютПоДням.Курс, 1) * ЕСТЬNULL(ВалРуб.Кратность, 1) / (ЕСТЬNULL(ТаблицаВалютПоДням.Кратность, 1) * ЕСТЬNULL(ВалРуб.Курс, 1)), 0)) КАК СуммаОплат,
	Оплаты.ЗАказ КАК Заказ,
	1 КАК КолОплат
ПОМЕСТИТЬ ОплатыРублях
ИЗ
	Оплаты КАК Оплаты
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют.СрезПоследних(
				{(&amp;КонецПериода)},
				Валюта В
					(ВЫБРАТЬ
						Константы.ВалютаУправленческогоУчета
					ИЗ
						Константы)) КАК ВалРуб
		ПО (ИСТИНА)
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаВалютПоДням КАК ТаблицаВалютПоДням
		ПО Оплаты.Оплата.Валюта = ТаблицаВалютПоДням.Валюта
			И Оплаты.Оплата = ТаблицаВалютПоДням.Оплата

СГРУППИРОВАТЬ ПО
	Оплаты.ЗАказ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыРублях.СуммаОплат,
	ЗакПокупИИнтЗаказы.СуммаОборотЗАказ,
	ЗакПокупИИнтЗаказы.КолЗаказов,
	ОплатыРублях.КолОплат,
	ЗакПокупИИнтЗаказы.ЗаказИсточник,
	ЗакПокупИИнтЗаказы.ЗаказВидИсточника,
	ЗакПокупИИнтЗаказы.Заказ,
	ОплатыРублях.Заказ КАК Заказ1
ИЗ
	ЗакПокупИИнтЗаказы КАК ЗакПокупИИнтЗаказы
		ПОЛНОЕ СОЕДИНЕНИЕ ОплатыРублях КАК ОплатыРублях
		ПО ЗакПокупИИнтЗаказы.Заказ = ОплатыРублях.Заказ</query>
	</dataSet>
	<totalField>
		<dataPath>КолОплат</dataPath>
		<expression>Сумма(КолОплат)</expression>
		<group>ЗаказВидИсточника</group>
		<group>ЗаказИсточник</group>
	</totalField>
	<totalField>
		<dataPath>КолЗаказов</dataPath>
		<expression>Сумма(КолЗаказов)</expression>
		<group>ЗаказВидИсточника</group>
		<group>ЗаказИсточник</group>
	</totalField>
	<totalField>
		<dataPath>СуммаОборотЗАказ</dataPath>
		<expression>Сумма(СуммаОборотЗАказ)</expression>
	</totalField>
	<totalField>
		<dataPath>СуммаОплат</dataPath>
		<expression>Сумма(СуммаОплат)</expression>
	</totalField>
	<parameter>
		<name>НачалоПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Начало периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>КонецПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Конец периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>Автор</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Автор</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.Пользователи</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>ОсновнойМенеджер</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Основной менеджер</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.Пользователи</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>ПричинаОтказа</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Причина отказа</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.ПричиныОтказов</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>false</useRestriction>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗаказВидИсточника</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗаказИсточник</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КолЗаказов</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КолОплат</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаОборотЗАказ</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаОплат</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Заказ</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:dataParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>НачалоПериода</dcscor:parameter>
					<dcscor:value xsi:type="xs:dateTime">0001-01-01T00:00:00</dcscor:value>
					<dcsset:userSettingID>fa61f55a-8da0-414c-b6e1-cffed92b543d</dcsset:userSettingID>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>КонецПериода</dcscor:parameter>
					<dcscor:value xsi:type="xs:dateTime">0001-01-01T00:00:00</dcscor:value>
					<dcsset:userSettingID>6186464a-b67e-4148-b1e2-7487a6fa2a10</dcsset:userSettingID>
				</dcscor:item>
			</dcsset:dataParameters>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:groupItems>
					<dcsset:item xsi:type="dcsset:GroupItemField">
						<dcsset:field>ЗаказИсточник</dcsset:field>
						<dcsset:groupType>Items</dcsset:groupType>
						<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
						<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
						<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
					</dcsset:item>
				</dcsset:groupItems>
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
				<dcsset:item xsi:type="dcsset:StructureItemGroup">
					<dcsset:groupItems>
						<dcsset:item xsi:type="dcsset:GroupItemField">
							<dcsset:field>ЗаказВидИсточника</dcsset:field>
							<dcsset:groupType>Items</dcsset:groupType>
							<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
							<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
							<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
						</dcsset:item>
					</dcsset:groupItems>
					<dcsset:order>
						<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
					</dcsset:order>
					<dcsset:selection>
						<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
					</dcsset:selection>
					<dcsset:item xsi:type="dcsset:StructureItemGroup">
						<dcsset:order>
							<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
						</dcsset:order>
						<dcsset:selection>
							<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
						</dcsset:selection>
					</dcsset:item>
				</dcsset:item>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>